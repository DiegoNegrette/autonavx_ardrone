<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>

<meta name="google-site-verification" content="CjkdY6BqKWAVmQ78_iSq6J7ZZ9AoL7-CjFVBYGg9FU4">
<script src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/ga.js" async="" type="text/javascript"></script><script type="text/javascript" src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/sorttable.js"></script>
<script type="text/javascript" src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/ASCIIMathML.js"></script>
<script type="text/javascript" src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/jquery-1.js"></script>                         
<script type="text/javascript" src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/seesaw.js"></script> 
<script type="text/javascript" src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/rosversion.js"></script> 
<script type="text/javascript" src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/RGraph_002.js"></script>
<script type="text/javascript" src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/RGraph.js"></script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-17821189-2']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="robots" content="index,nofollow">

<title>tum_ardrone/drone_stateestimation - ROS Wiki</title>
<script type="text/javascript" src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/common.js"></script>

<script type="text/javascript">
<!--
var search_hint = "Search";
//-->
</script>


<link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/common.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="screen" href="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/screen.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/print.css">
<link rel="stylesheet" type="text/css" charset="utf-8" media="projection" href="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/projection.css">

<!-- css only for MS IE6/IE7 browsers -->
<!--[if lt IE 8]>
   <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="/moin_static193/rostheme/css/msie.css">
<![endif]-->





<link rel="Start" href="http://ros.org/wiki/Documentation">
<link rel="Alternate" title="Wiki Markup" href="http://ros.org/wiki/tum_ardrone/drone_stateestimation?action=raw">
<link rel="Alternate" media="print" title="Print View" href="http://ros.org/wiki/tum_ardrone/drone_stateestimation?action=print">
<link rel="Up" href="http://ros.org/wiki/tum_ardrone">
<link rel="Appendix" title="map.png" href="http://ros.org/wiki/tum_ardrone/drone_stateestimation?action=AttachFile&amp;do=view&amp;target=map.png">
<link rel="Appendix" title="video.png" href="http://ros.org/wiki/tum_ardrone/drone_stateestimation?action=AttachFile&amp;do=view&amp;target=video.png">
<link rel="Search" href="http://ros.org/wiki/FindPage">
<link rel="Index" href="http://ros.org/wiki/TitleIndex">
<link rel="Glossary" href="http://ros.org/wiki/WordIndex">
<link rel="Help" href="http://ros.org/wiki/HelpOnFormatting">
</head>

<body dir="ltr" lang="en">

<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script><script src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/ga.js" type="text/javascript"></script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-5950817-2");
pageTracker._trackPageview();
} catch(err) {}</script>

<script type="text/javascript">
<!--// Initialize search form
var f = document.getElementById('searchform');
f.getElementsByTagName('label')[0].style.display = 'none';
var e = document.getElementById('searchinput');
searchChange(e);
searchBlur(e);

function handleSubmit() {
  var f = document.getElementById('searchform');
  var t = document.getElementById('searchinput');
  var r = document.getElementById('real_searchinput');
  
  //alert("handleSubmit "+ t.value);
  if(t.value.match(/review/)) {
    r.value = t.value;
  } else {
    //r.value = t.value + " -PackageReviewCategory -StackReviewCategory -M3Review -DocReview -ApiReview -HelpOn -BadContent -LocalSpellingWords";
    r.value = t.value + " -PackageReviewCategory -StackReviewCategory -DocReview -ApiReview";
  }
  //return validate(f);
}
//-->
</script>

<div id="dpage">
  <div id="dpage-inner">
    <div id="header"><div id="topnav">
      <table id="topnav-table">
        <tbody><tr>
          <td valign="top" width="300"><a href="http://ros.org/"><img src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/ros_org.png" alt="ros.org" height="51" border="0" width="238"></a></td>
          <td valign="middle">
            <a href="http://ros.org/wiki/About%20ros.org">About</a>
            |
            <a href="http://ros.org/wiki/Support">Support</a>
            |
            <a href="http://answers.ros.org/">answers.ros.org</a>

<!--   <a href="http://roscon.ros.org/?page_id=109"><img align="middle" style="padding-left: 15px;" src="http://ros.org/images/roscon_wiki_header.png" width="133" height="38" alt="roscon" /></a> -->

          </td>

          <td align="right" valign="middle">

<script language="Javascript">

function Searchy(theButton){

theForm = theButton.form;
newID = theForm.input.value;
theForm.q.value = newID;
theForm.input.value=theForm.input.value

}
</script>


<form action="http://www.ros.org/search/index.html" id="cse">
  <div>
    <label>Search:</label>
    <input name="cx" value="013029357434904786434:afn5eukzpgg" type="hidden">
    <input name="cof" value="FORID:11;NB:1" type="hidden">
    <input name="filter" value="0" type="hidden">
    <input name="num" value="10" type="hidden">

    <input name="ie" value="UTF-8" type="hidden">
    <input name="input" id="input" autocomplete="on" style="width: 35%" type="text">
    <input name="q" value="" type="hidden">
    <input name="sa" value="Submit" onclick="Searchy(this)" type="submit">

  </div>
</form>

         </td>
      </tr>
      <tr>
        <td colspan="3" height="53" width="1024"><nobr><img src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/menu_left.png" alt="" height="53" width="17"><a href="http://ros.org/wiki/"><img src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/menu_documentation.png" alt="Documentation" height="53" border="0" width="237"></a><img src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/menu_spacer.png" height="53" width="69"><a href="http://www.ros.org/browse/"><img src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/menu_browse_software.png" alt="Browse Software" height="53" border="0" width="268"></a><img src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/menu_spacer.png" height="53" width="69"><a href="http://www.ros.org/news"><img src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/menu_news.png" alt="News" height="53" border="0" width="84"></a><img src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/menu_spacer.png" height="53" width="69"><a href="http://www.ros.org/wiki/ROS/Installation"><img src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/menu_download.png" alt="Download" height="53" border="0" width="151"></a><img src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/menu_right.png" height="53" width="60"></nobr></td>

      </tr>
    </tbody></table> <!-- topnav-table -->

    </div> <!-- /#topav -->
  </div> <!-- /#header -->


<div id="header2">

<ul id="pagelocation">
<li><a href="http://ros.org/wiki/tum_ardrone">tum_ardrone</a></li><li><a class="backlink" href="http://ros.org/wiki/tum_ardrone/drone_stateestimation?action=fullsearch&amp;context=180&amp;value=linkto%3A%22tum_ardrone%2Fdrone_stateestimation%22" rel="nofollow" title="Click to do a full-text search for this title">drone_stateestimation</a></li>
</ul>

<div id="locationline">
</div>
</div>

<div id="sidebar">
<div class="sidepanel">
<h1>Wiki</h1>

<ul id="navibar">
<li class="wikilink"><a href="http://ros.org/wiki/ROS">ROS</a></li><li class="wikilink"><a href="http://ros.org/wiki/StackList">StackList</a></li><li class="wikilink"><a href="http://ros.org/wiki/RecentChanges">RecentChanges</a></li><li class="current"><a href="http://ros.org/wiki/tum_ardrone/drone_stateestimation">drone_stateestimation</a></li>
</ul>

</div>
<div class="sidepanel">
<h1>Page</h1>
<ul class="editbar"><li><span class="disabled">Immutable Page</span></li><li class="toggleCommentsButton" style="display:none;"><a href="#" class="nbcomment" onclick="toggleComments();return false;">Comments</a></li><li><a class="nbinfo" href="http://ros.org/wiki/tum_ardrone/drone_stateestimation?action=info" rel="nofollow">Info</a></li><li><a class="nbattachments" href="http://ros.org/wiki/tum_ardrone/drone_stateestimation?action=AttachFile" rel="nofollow">Attachments</a></li><li>
<form class="actionsmenu" method="GET" action="/wiki/tum_ardrone/drone_stateestimation">
<div>
    
    <select name="action" onchange="if ((this.selectedIndex != 0) &amp;&amp;
                      (this.options[this.selectedIndex].disabled == false)) {
                this.form.submit();
            }
            this.selectedIndex = 0;">
        <option selected="selected" value="show">More Actions:</option><option value="raw">Raw Text</option>
<option value="print">Print View</option>
<option value="show" disabled="disabled" class="disabled">Delete Cache</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="SpellCheck">Check Spelling</option>
<option value="LikePages">Like Pages</option>
<option value="LocalSiteMap">Local Site Map</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="RenamePage" disabled="disabled" class="disabled">Rename Page</option>
<option value="DeletePage" disabled="disabled" class="disabled">Delete Page</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="show" disabled="disabled" class="disabled">Subscribe User</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="show" disabled="disabled" class="disabled">Remove Spam</option>
<option value="show" disabled="disabled" class="disabled">Revert to this revision</option>
<option value="PackagePages">Package Pages</option>
<option value="SyncPages">Sync Pages</option>
<option value="show" disabled="disabled" class="disabled">------------------------</option>
<option value="CreatePdfDocument">CreatePdfDocument</option>
<option value="Load">Load</option>
<option value="RawFile">RawFile</option>
<option value="Save">Save</option>
<option value="SlideShow">SlideShow</option>
    </select>
    
    
</div>
<script type="text/javascript">
<!--// Init menu
actionsMenuInit('More Actions:');
//-->
</script>
</form>
</li></ul>

</div>
<div class="sidepanel">
<h1>User</h1>
<ul id="username"><li><a href="http://ros.org/wiki/tum_ardrone/drone_stateestimation?action=login" id="login" rel="nofollow">Login</a></li></ul>
</div>
</div>

<div id="page" dir="ltr" lang="en">
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867">


<span style="text-align:left">&nbsp;&nbsp;<a href="javascript:toggleDocStatus()">Documentation Status</a></span></p><div id="doc_status" style="background:#CCCCCC;display:none;margin-top:0px;margin-bottom:0px;padding-top:0px"><ul style="padding-top:5px;margin-top:0px;margin-bottom:0px;padding-bottom:5px;"><li><b>electric:</b> Cannot load information on <strong>name: tum_ardrone/drone_stateestimation, distro: electric</strong>, which means that it is not yet in our index.
Please see <a href="http://www.ros.org/wiki/Get%20Involved#Indexing_Your_.2A-ros-pkg_Repository_for_Documentation_Generation">this page</a> for information on how to submit your repository to our index.</li><br><li><b>fuerte:</b> Cannot load information on <strong>name: tum_ardrone/drone_stateestimation, distro: fuerte</strong>, which means that it is not yet in our index.
Please see <a href="http://www.ros.org/wiki/Get%20Involved#Indexing_Your_.2A-ros-pkg_Repository_for_Documentation_Generation">this page</a> for information on how to submit your repository to our index.</li><br><li><b>groovy:</b> Cannot load information on <strong>name: tum_ardrone/drone_stateestimation, distro: groovy</strong>, which means that it is not yet in our index.
Please see <a href="http://www.ros.org/wiki/Get%20Involved#Indexing_Your_.2A-ros-pkg_Repository_for_Documentation_Generation">this page</a> for information on how to submit your repository to our index.</li><br><li><b>hydro:</b> Cannot load information on <strong>name: tum_ardrone/drone_stateestimation, distro: hydro</strong>, which means that it is not yet in our index.
Please see <a href="http://www.ros.org/wiki/Get%20Involved#Indexing_Your_.2A-ros-pkg_Repository_for_Documentation_Generation">this page</a> for information on how to submit your repository to our index.</li><br></ul></div><div style="display: none;" class="version electric">Cannot load information on <strong>name: tum_ardrone/drone_stateestimation, distro: electric</strong>, which means that it is not yet in our index.
Please see <a href="http://www.ros.org/wiki/Get%20Involved#Indexing_Your_.2A-ros-pkg_Repository_for_Documentation_Generation">this page</a> for information on how to submit your repository to our index.</div>
<div style="display: none;" class="version fuerte">Cannot load information on <strong>name: tum_ardrone/drone_stateestimation, distro: fuerte</strong>, which means that it is not yet in our index.
Please see <a href="http://www.ros.org/wiki/Get%20Involved#Indexing_Your_.2A-ros-pkg_Repository_for_Documentation_Generation">this page</a> for information on how to submit your repository to our index.</div>
<div style="display: none;" class="version groovy">Cannot load information on <strong>name: tum_ardrone/drone_stateestimation, distro: groovy</strong>, which means that it is not yet in our index.
Please see <a href="http://www.ros.org/wiki/Get%20Involved#Indexing_Your_.2A-ros-pkg_Repository_for_Documentation_Generation">this page</a> for information on how to submit your repository to our index.</div>
<div style="display: none;" class="version hydro">Cannot load information on <strong>name: tum_ardrone/drone_stateestimation, distro: hydro</strong>, which means that it is not yet in our index.
Please see <a href="http://www.ros.org/wiki/Get%20Involved#Indexing_Your_.2A-ros-pkg_Repository_for_Documentation_Generation">this page</a> for information on how to submit your repository to our index.</div> <span class="anchor" id="line-2"></span><div class="table-of-contents"><p class="table-of-contents-heading">Contents</p><ol><li>
<a href="#Overview">Overview</a></li><li>
<a href="#Functionality">Functionality</a><ol><li>
<a href="#Video_Window">Video Window</a></li><li>
<a href="#Map_Window">Map Window</a></li></ol></li><li>
<a href="#Tips_for_good_PTAM_and_Scale_Estimation_Performance">Tips for good PTAM and Scale Estimation Performance</a></li><li>
<a href="#Recording_.26_Playing_back_flights">Recording &amp; Playing back flights</a></li><li>
<a href="#Parameters">Parameters</a></li><li>
<a href="#Topics">Topics</a></li><li>
<a href="#Dynamically_Reconfigurable_Parameters">Dynamically Reconfigurable Parameters</a></li></ol></div><p class="line874"> <span class="anchor" id="line-3"></span><span class="anchor" id="line-4"></span></p><p class="line867">
</p><h1 id="Overview">Overview</h1>
<span class="anchor" id="line-5"></span><p class="line862">Estimates the drone's position based on sent navdata, sent control commands and PTAM. <strong>Requires messages to be sent on both /ardrone/navdata (&gt;100Hz) and /ardrone/image_raw (&gt;10Hz)</strong>, i.e. a connected drone with running ardrone_autonomy node, or a .bag replay of at least those two channels. <span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span></p><p class="line867"><strong>ardrone_autonomy should be started with:</strong> <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span><span class="anchor" id="line-10"></span></p><pre><span class="anchor" id="line-1-1"></span>rosrun ardrone_autonomy ardrone_driver _navdata_demo:=0 _loop_rate:=500</pre><span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><p class="line874">To
 properly estimate PTAM's scale, it is best to fly up and down a little 
bit (e.g. 1m up and 1m down) immediately after initialization. The 
methods used are described in the following publications: <span class="anchor" id="line-13"></span></p><ul><li><p class="line891"><a class="https" href="https://vision.in.tum.de/_media/spezial/bib/engel12iros.pdf">Camera-Based Navigation of a Low-Cost Quadrocopter</a> (J. Engel, J. Sturm, D. Cremers) <span class="anchor" id="line-14"></span></p></li><li><p class="line891"><a class="https" href="https://vision.in.tum.de/_media/spezial/bib/engel12vicomor.pdf">Accurate Figure Flying with a Quadrocopter Using Onboard Visual and Inertial Sensing</a> (J. Engel, J. Sturm, D. Cremers) <span class="anchor" id="line-15"></span></p></li></ul><p class="line874">This node in particular implements <span class="anchor" id="line-16"></span></p><ul><li>the described EKF for state-estimation, including the dynamic model of the drone <span class="anchor" id="line-17"></span></li><li>time delay compensation <span class="anchor" id="line-18"></span></li><li>scale estimation <span class="anchor" id="line-19"></span></li><li>incorporation of PTAM <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span><span class="anchor" id="line-22"></span></li></ul><p class="line867">
</p><h1 id="Functionality">Functionality</h1>
<span class="anchor" id="line-23"></span><p class="line874">There are 
two windows, one shows the video and PTAM's map points, the other one 
the map. To issue key commands, focus the respective window and hit a 
key. <span class="anchor" id="line-24"></span>This generates a command on /tum_ardrone/com, which in turn is parsed and does something: <span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span></p><p class="line867">
</p><h2 id="Video_Window">Video Window</h2>
<span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><p class="line867"><img alt="video.png" class="attachment" src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/drone_stateestimation.png" title="video.png"> <span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span></p><p class="line867"><strong>Key Assignment:</strong> <span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><span class="anchor" id="line-41"></span></p><pre><span class="anchor" id="line-1-2"></span>r -&gt; "p reset": resets PTAM.
<span class="anchor" id="line-2-1"></span>u -&gt; "p toggleUI": toggles debug info to be displayed
<span class="anchor" id="line-3-1"></span>space -&gt; "p space": takes first / second keyframe for PTAM's initialization
<span class="anchor" id="line-4-1"></span>k -&gt; "p keyframe": forces PTAM to take a keyframe.
<span class="anchor" id="line-5-1"></span>l -&gt; "toggleLog": starts / stops extensive logging of all kinds of values to a file.
<span class="anchor" id="line-6-1"></span>m -&gt; "p toggleLockMap": locks map, equivalent to parameter PTAMMapLock. 
<span class="anchor" id="line-7-1"></span>                        May be overwritten by the dyn. config parameter setting.
<span class="anchor" id="line-8-1"></span>n -&gt; "p toggleLockSync": locks sync, equivalent to parameter PTAMSyncLock. 
<span class="anchor" id="line-9-1"></span>                         May be overwritten by the dyn. config parameter setting.</pre><span class="anchor" id="line-42"></span><span class="anchor" id="line-43"></span><p class="line867"><strong>Setting target using the mouse:</strong> <span class="anchor" id="line-44"></span><span class="anchor" id="line-45"></span></p><p class="line874">Clicking on the video window will generate way points, which are sent to drone_autopilot (if running): <span class="anchor" id="line-46"></span></p><ul><li>left-click: fly (x,y,0)m relative to the current position. The image-center is (0,0), borders are 2m respectively. <span class="anchor" id="line-47"></span></li><li>right-click: fly (0,0,y)m and rotate yaw by x degree. The Image-center is (0,0), borders are 2m and 90 degree respectively. <span class="anchor" id="line-48"></span><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span></li></ul><p class="line867">
</p><h2 id="Map_Window">Map Window</h2>
<span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><p class="line867"><img alt="map.png" class="attachment" src="tum_ardrone_drone_stateestimation%20-%20ROS%20Wiki_files/drone_stateestimation_002.png" title="map.png"> <span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span></p><p class="line867"><strong>Key Assignment:</strong> <span class="anchor" id="line-55"></span><span class="anchor" id="line-56"></span><span class="anchor" id="line-57"></span><span class="anchor" id="line-58"></span><span class="anchor" id="line-59"></span><span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span></p><pre><span class="anchor" id="line-1-3"></span>r -&gt; "f reset": resets EKF and PTAM.
<span class="anchor" id="line-2-2"></span>u -&gt; "m toggleUI": toggles debug info to be displayed
<span class="anchor" id="line-3-2"></span>v -&gt; "m resetView": resets viewpoint of viewer
<span class="anchor" id="line-4-2"></span>l -&gt; "toggleLog": starts / stops extensive logging of all kinds of values to a file.
<span class="anchor" id="line-5-2"></span>v -&gt; "m clearTrail": clears green drone-trail.</pre><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><p class="line867">
</p><h1 id="Tips_for_good_PTAM_and_Scale_Estimation_Performance">Tips for good PTAM and Scale Estimation Performance</h1>
<span class="anchor" id="line-64"></span><ul><li>PTAM works best in 
indoor environments, with loads of "structure" in the field of view of 
the camera. That is cupboards, desks, furniture, objects, texture etc. <span class="anchor" id="line-65"></span></li><li><p class="line862">PTAM
 does not work well with Trees &amp; Plants, in particular in 
combination with wind, as they tend to violate the "static-world" 
assumption. <span class="anchor" id="line-66"></span></p></li><li>PTAM 
cannot track well through rotation without adequate translation. Hence 
try to not change the drone's yaw-rotation too much. <span class="anchor" id="line-67"></span></li><li>The
 keypoints should ideally be at a distance of 2m to 10m. For smaller 
distances, the drone moves too quickly. For larger distances, the pose 
estimate gets too inaccurate, although this has not been tested well. <span class="anchor" id="line-68"></span></li><li><p class="line862">Ideally,
 keypoints should be found at different depths, i.e. NOT lie on the same
 plane (-&gt; a single textured wall is, contrary to popular belief, not
 good for PTAM's performance when using a small field of view). This is 
due to the resulting difficulty to distinguish between e.g. vertical 
motion and pitch-rotation. <span class="anchor" id="line-69"></span></p></li><li>Flying
 up and down makes the scale estimate more accurate, as the main source 
of metric information is the ultrasound altimeter. Only flying 
horizontally (in particular over uneven ground (i.e. altimeter gets 
useless)) leads to bad scale estimates, and hence a bad flight 
performance. <span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span></li></ul><p class="line867">
</p><h1 id="Recording_.26_Playing_back_flights">Recording &amp; Playing back flights</h1>
<span class="anchor" id="line-72"></span><p class="line874">You can record data from a (manual) flight using  <span class="anchor" id="line-73"></span><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span></p><pre><span class="anchor" id="line-1-4"></span>rosbag record -O flight.bag /ardrone/image_raw /ardrone/navdata /cmd_vel</pre><span class="anchor" id="line-76"></span><p class="line874">and then play it back using  <span class="anchor" id="line-77"></span><span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span></p><pre><span class="anchor" id="line-1-5"></span>rosbag play -l flight.bag</pre><span class="anchor" id="line-80"></span><p class="line874">This
 can be used to test the stateestimation etc. without risking to crash 
your drone / actually flying at the same time. Remember to shut down the
 ardrone_driver node and setting the Control Source to "None" (or 
shutting down drone_gui) when replaying a flight, otherwise the video / 
navdata / control commands are going to mix. <span class="anchor" id="line-81"></span><span class="anchor" id="line-82"></span></p><p class="line867">
</p><h1 id="Parameters">Parameters</h1>
<span class="anchor" id="line-83"></span><ul><li><p class="line891"><tt>~publishFreq</tt>: frequency, at which the drone's estimated position is calculated &amp; published. Default: 30Hz <span class="anchor" id="line-84"></span></p></li><li><p class="line891"><tt>~calibFile</tt>: camera calibration file. If not set, the defaults are used (camcalib/ardroneX_default.txt). <span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><span class="anchor" id="line-87"></span></p></li></ul><p class="line867">
</p><h1 id="Topics">Topics</h1>
<span class="anchor" id="line-88"></span><ul><li>reads /ardrone/navdata <span class="anchor" id="line-89"></span></li><li>reads /ardrone/image_raw <span class="anchor" id="line-90"></span></li><li>reads /cmd_vel <span class="anchor" id="line-91"></span></li><li>writes /ardrone/predictedPose <span class="anchor" id="line-92"></span></li><li><p class="line862">reads &amp; writes /tum_ardrone/com <span class="anchor" id="line-93"></span><span class="anchor" id="line-94"></span><span class="anchor" id="line-95"></span></p></li></ul><p class="line867">
</p><h1 id="Dynamically_Reconfigurable_Parameters">Dynamically Reconfigurable Parameters</h1>
<span class="anchor" id="line-96"></span><p class="line862">See the <a href="http://ros.org/wiki/dynamic_reconfigure">dynamic_reconfigure</a> package for details on dynamically reconfigurable parameters. <span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span></p><pre><span class="anchor" id="line-1-6"></span>UseControlGains: 
<span class="anchor" id="line-2-3"></span>      whether to use control gains for EKF prediction.
<span class="anchor" id="line-3-3"></span>
<span class="anchor" id="line-4-3"></span>UsePTAM: 
<span class="anchor" id="line-5-3"></span>      whether to use PTAM pose estimates as EKF update
<span class="anchor" id="line-6-2"></span>
<span class="anchor" id="line-7-2"></span>UseNavdata: 
<span class="anchor" id="line-8-2"></span>      whether to use Navdata information for EKF update
<span class="anchor" id="line-9-2"></span>      =&gt; If UsePTAM and UseNavdata are set to false, the EKF is never 
<span class="anchor" id="line-10-1"></span>         updated and acts as a pure simulator, predicting the pose based 
<span class="anchor" id="line-11-1"></span>         on the control commands received (on /cmd_vel). 
<span class="anchor" id="line-12-1"></span>         Good for experimenting.
<span class="anchor" id="line-13-1"></span>
<span class="anchor" id="line-14-1"></span>PTAMMapLock: 
<span class="anchor" id="line-15-1"></span>      lock PTAM map (no more KF)
<span class="anchor" id="line-16-1"></span>
<span class="anchor" id="line-17-1"></span>PTAMSyncLock: 
<span class="anchor" id="line-18-1"></span>      lock PTAM map sync (fix scale and pose offsets etc.)
<span class="anchor" id="line-19-1"></span>
<span class="anchor" id="line-20-1"></span>PTAMMaxKF: 
<span class="anchor" id="line-21-1"></span>      maximum amount of KF PTAM takes. 
<span class="anchor" id="line-22-1"></span>
<span class="anchor" id="line-23-1"></span>
<span class="anchor" id="line-24-1"></span>PTAMMinKFDist: 
<span class="anchor" id="line-25-1"></span>      min. distance between two KF (in meters)
<span class="anchor" id="line-26-1"></span>
<span class="anchor" id="line-27-1"></span>PTAMMinKFWiggleDist: 
<span class="anchor" id="line-28-1"></span>      min. distance between two KF (relative to mean scene depth).
<span class="anchor" id="line-29-1"></span>
<span class="anchor" id="line-30-1"></span>PTAMMinKFTimeDiff: 
<span class="anchor" id="line-31-1"></span>      min time between two KF.
<span class="anchor" id="line-32-1"></span>      =&gt; PTAM takes a new KF if (PTAMMinKFTimeDiff &amp;&amp; (PTAMMinKFDist || 
<span class="anchor" id="line-33-1"></span>         PTAMMinKFWiggleDist)), and tracking is good etc.
<span class="anchor" id="line-34-1"></span>
<span class="anchor" id="line-35-1"></span>RescaleFixOrigin: 
<span class="anchor" id="line-36-1"></span>      If the scale of the Map is reestimated, only one point in 
<span class="anchor" id="line-37-1"></span>      the mapping PTAM &lt;-&gt; World remains fixed.
<span class="anchor" id="line-38-1"></span>      =&gt; If RescaleFixOrigin == false, this is the current pose of the drone 
<span class="anchor" id="line-39-1"></span>         (to avoid sudden, large "jumps"). This however makes the map "drift".
<span class="anchor" id="line-40-1"></span>      =&gt; If RescaleFixOrigin == true, by default this is the initialization 
<span class="anchor" id="line-41-1"></span>         point where the second KF has been taken (drone position may jump 
<span class="anchor" id="line-42-1"></span>         suddenly, but map remains fixed.). 
<span class="anchor" id="line-43-1"></span>         The fixpoint may be set by the command "lockScaleFP".
<span class="anchor" id="line-44-1"></span>                  
<span class="anchor" id="line-45-1"></span>                  
<span class="anchor" id="line-46-1"></span>c1 ... c8: 
<span class="anchor" id="line-47-1"></span>      prediction model parameters of the EKF. See the publications.</pre><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><p class="line867"><span class="anchor" id="line-148"></span></p><p class="line867"><span class="anchor" id="line-149"></span><span class="anchor" id="bottom"></span></p></div></div>
<div id="pagebottom"></div>
</div>

<p id="pageinfo" class="info" dir="ltr" lang="en">Wiki: tum_ardrone/drone_stateestimation  (last edited 2012-12-21 14:55:44 by <span title="JakobEngel @ d174150.adsl.hansenet.de[80.171.174.150]"><a class="nonexistent" href="http://ros.org/wiki/JakobEngel" title="JakobEngel @ d174150.adsl.hansenet.de[80.171.174.150]">JakobEngel</a></span>)</p>




<div class="footer">
Except where otherwise noted, the ROS wiki is licensed under <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0</a>.
</div>

  </div> <!-- /#dpage-inner, /#dpage -->





</body></html>